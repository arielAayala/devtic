SET FOREIGN_KEY_CHECKS=0;
SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";
CREATE DATABASE IF NOT EXISTS `devtic` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_spanish_ci;
USE `devtic`;

CREATE TABLE IF NOT EXISTS `anexosdemandas` (
  `idAnexoDemanda` int(11) NOT NULL AUTO_INCREMENT,
  `idDemanda` int(11) NOT NULL,
  `urlAnexoDemanda` varchar(255) NOT NULL,
  `nombreAnexoDemanda` varchar(255) NOT NULL,
  PRIMARY KEY (`idAnexoDemanda`),
  KEY `idDemanda` (`idDemanda`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `anexosnotas` (
  `idAnexoNota` int(11) NOT NULL AUTO_INCREMENT,
  `idNota` int(11) NOT NULL,
  `urlAnexoNota` varchar(255) NOT NULL,
  `nombreAnexoNota` varchar(255) NOT NULL,
  PRIMARY KEY (`idAnexoNota`),
  KEY `idNota` (`idNota`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `correos` (
  `idCorreo` int(11) NOT NULL AUTO_INCREMENT,
  `idPersona` int(11) NOT NULL,
  `direccionCorreo` varchar(255) NOT NULL,
  PRIMARY KEY (`idCorreo`),
  KEY `idPersona` (`idPersona`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `demandas` (
  `idDemanda` int(11) NOT NULL AUTO_INCREMENT,
  `idEstado` int(11) NOT NULL,
  `idTipo` int(11) NOT NULL,
  `idOrganizacion` int(11) NOT NULL,
  `tituloDemanda` varchar(255) NOT NULL,
  `motivoDemanda` text NOT NULL,
  `fechaIngresoDemanda` date NOT NULL,
  `fechaCierreDemanda` date DEFAULT NULL,
  `almacenDemanda` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`idDemanda`),
  KEY `idEstado` (`idEstado`),
  KEY `idTipo` (`idTipo`),
  KEY `idOrganizacion` (`idOrganizacion`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `domicilios` (
  `idDomicilio` int(11) NOT NULL AUTO_INCREMENT,
  `idPersona` int(11) NOT NULL,
  `idLocalidad` int(11) NOT NULL,
  `direccionDomicilio` int(11) NOT NULL,
  PRIMARY KEY (`idDomicilio`),
  KEY `idPersona` (`idPersona`),
  KEY `idLocalidad` (`idLocalidad`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `especialidades` (
  `idEspecialidad` int(11) NOT NULL AUTO_INCREMENT,
  `nombreEspecialidad` varchar(100) NOT NULL,
  PRIMARY KEY (`idEspecialidad`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `estados` (
  `idEstado` int(11) NOT NULL AUTO_INCREMENT,
  `nombreEstado` varchar(100) NOT NULL,
  PRIMARY KEY (`idEstado`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `grupos` (
  `idProfesional` int(11) NOT NULL,
  `idDemanda` int(11) NOT NULL,
  `creadorDemanda` tinyint(1) NOT NULL,
  KEY `idDemanda` (`idDemanda`),
  KEY `idProfesional` (`idProfesional`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `localidades` (
  `idLocalidad` int(11) NOT NULL AUTO_INCREMENT,
  `nombreLocalidad` varchar(50) NOT NULL,
  PRIMARY KEY (`idLocalidad`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `notas` (
  `idNota` int(11) NOT NULL AUTO_INCREMENT,
  `idDemanda` int(11) NOT NULL,
  `idProfesionalCreador` int(11) NOT NULL,
  `idTipoNota` int(11) NOT NULL,
  `tituloNota` varchar(255) NOT NULL,
  `fechaCreacionNota` date NOT NULL,
  `descripcionNota` text NOT NULL,
  PRIMARY KEY (`idNota`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `organizaciones` (
  `idOrganizacion` int(11) NOT NULL AUTO_INCREMENT,
  `idPersonaResponsable` int(11) DEFAULT NULL,
  `idLocalidad` int(11) NOT NULL,
  `nombreOrganizacion` varchar(255) NOT NULL,
  `direccionOrganizacion` varchar(255) NOT NULL,
  PRIMARY KEY (`idOrganizacion`),
  KEY `idLocalidad` (`idLocalidad`),
  KEY `idPersonaResponsable` (`idPersonaResponsable`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `parentesco` (
  `idParentesco` int(11) NOT NULL AUTO_INCREMENT,
  `nombreParentesco` varchar(255) NOT NULL,
  PRIMARY KEY (`idParentesco`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `personas` (
  `idPersona` int(11) NOT NULL AUTO_INCREMENT,
  `nombrePersona` varchar(200) NOT NULL,
  `dniPersona` int(8) NOT NULL,
  PRIMARY KEY (`idPersona`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `personasinvolucradas` (
  `idPersonaInvolucrada` int(11) NOT NULL AUTO_INCREMENT,
  `idPersona` int(11) NOT NULL,
  `idDemanda` int(11) NOT NULL,
  `idParentesco` int(11) DEFAULT NULL,
  `demandante` tinyint(1) NOT NULL,
  PRIMARY KEY (`idPersonaInvolucrada`),
  KEY `idPersona` (`idPersona`),
  KEY `idDemanda` (`idDemanda`),
  KEY `idParentesco` (`idParentesco`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `profesionales` (
  `idProfesional` int(11) NOT NULL AUTO_INCREMENT,
  `idPersona` int(11) NOT NULL,
  `idEspecialidad` int(11) NOT NULL,
  `correoProfesional` varchar(100) NOT NULL,
  `contrasenaProfesional` varchar(255) NOT NULL,
  `fotoProfesional` varchar(255) DEFAULT NULL,
  `prioridadProfesional` tinyint(1) NOT NULL,
  PRIMARY KEY (`idProfesional`),
  KEY `idPersona` (`idPersona`),
  KEY `idEspecialidad` (`idEspecialidad`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `roles` (
  `idRol` int(11) NOT NULL AUTO_INCREMENT,
  `nombreRol` varchar(255) NOT NULL,
  PRIMARY KEY (`idRol`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `rolespersonas` (
  `idRol` int(11) NOT NULL,
  `idPersonaInvolucrada` int(11) NOT NULL,
  KEY `idRol` (`idRol`),
  KEY `idPersonaInvolucrada` (`idPersonaInvolucrada`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `telefonos` (
  `idTelefono` int(11) NOT NULL AUTO_INCREMENT,
  `idPersona` int(11) NOT NULL,
  `numeroTelefono` int(11) NOT NULL,
  PRIMARY KEY (`idTelefono`),
  KEY `idPersona` (`idPersona`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `telefonosorganizacion` (
  `idTelefonoOrganizacion` int(11) NOT NULL AUTO_INCREMENT,
  `idOrganizacion` int(11) NOT NULL,
  `numeroTelefonoOrganizacion` int(11) NOT NULL,
  PRIMARY KEY (`idTelefonoOrganizacion`),
  KEY `idOrganizacion` (`idOrganizacion`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `tiponota` (
  `idTipoNota` int(11) NOT NULL AUTO_INCREMENT,
  `nombreTipoNota` varchar(255) NOT NULL,
  PRIMARY KEY (`idTipoNota`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE IF NOT EXISTS `tipos` (
  `idTipo` int(11) NOT NULL AUTO_INCREMENT,
  `nombreTipo` varchar(100) NOT NULL,
  PRIMARY KEY (`idTipo`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;


ALTER TABLE `anexosdemandas`
  ADD CONSTRAINT `anexosdemandas_ibfk_1` FOREIGN KEY (`idDemanda`) REFERENCES `demandas` (`idDemanda`);

ALTER TABLE `anexosnotas`
  ADD CONSTRAINT `anexosnotas_ibfk_1` FOREIGN KEY (`idNota`) REFERENCES `notas` (`idNota`);

ALTER TABLE `correos`
  ADD CONSTRAINT `correos_ibfk_1` FOREIGN KEY (`idPersona`) REFERENCES `personas` (`idPersona`);

ALTER TABLE `demandas`
  ADD CONSTRAINT `demandas_ibfk_1` FOREIGN KEY (`idEstado`) REFERENCES `estados` (`idEstado`),
  ADD CONSTRAINT `demandas_ibfk_2` FOREIGN KEY (`idTipo`) REFERENCES `tipos` (`idTipo`),
  ADD CONSTRAINT `demandas_ibfk_3` FOREIGN KEY (`idOrganizacion`) REFERENCES `organizaciones` (`idOrganizacion`);

ALTER TABLE `domicilios`
  ADD CONSTRAINT `domicilios_ibfk_1` FOREIGN KEY (`idPersona`) REFERENCES `personas` (`idPersona`),
  ADD CONSTRAINT `domicilios_ibfk_2` FOREIGN KEY (`idLocalidad`) REFERENCES `localidades` (`idLocalidad`);

ALTER TABLE `grupos`
  ADD CONSTRAINT `grupos_ibfk_1` FOREIGN KEY (`idDemanda`) REFERENCES `demandas` (`idDemanda`),
  ADD CONSTRAINT `grupos_ibfk_2` FOREIGN KEY (`idDemanda`) REFERENCES `demandas` (`idDemanda`),
  ADD CONSTRAINT `grupos_ibfk_3` FOREIGN KEY (`idProfesional`) REFERENCES `profesionales` (`idProfesional`);

ALTER TABLE `organizaciones`
  ADD CONSTRAINT `organizaciones_ibfk_1` FOREIGN KEY (`idPersonaResponsable`) REFERENCES `personas` (`idPersona`),
  ADD CONSTRAINT `organizaciones_ibfk_2` FOREIGN KEY (`idLocalidad`) REFERENCES `localidades` (`idLocalidad`),
  ADD CONSTRAINT `organizaciones_ibfk_3` FOREIGN KEY (`idPersonaResponsable`) REFERENCES `personas` (`idPersona`);

ALTER TABLE `personasinvolucradas`
  ADD CONSTRAINT `personasinvolucradas_ibfk_1` FOREIGN KEY (`idPersona`) REFERENCES `personas` (`idPersona`),
  ADD CONSTRAINT `personasinvolucradas_ibfk_2` FOREIGN KEY (`idDemanda`) REFERENCES `demandas` (`idDemanda`),
  ADD CONSTRAINT `personasinvolucradas_ibfk_3` FOREIGN KEY (`idParentesco`) REFERENCES `parentesco` (`idParentesco`);

ALTER TABLE `profesionales`
  ADD CONSTRAINT `profesionales_ibfk_1` FOREIGN KEY (`idPersona`) REFERENCES `personas` (`idPersona`),
  ADD CONSTRAINT `profesionales_ibfk_2` FOREIGN KEY (`idEspecialidad`) REFERENCES `especialidades` (`idEspecialidad`);

ALTER TABLE `rolespersonas`
  ADD CONSTRAINT `rolespersonas_ibfk_1` FOREIGN KEY (`idRol`) REFERENCES `roles` (`idRol`),
  ADD CONSTRAINT `rolespersonas_ibfk_2` FOREIGN KEY (`idPersonaInvolucrada`) REFERENCES `personasinvolucradas` (`idPersonaInvolucrada`);

ALTER TABLE `telefonos`
  ADD CONSTRAINT `telefonos_ibfk_1` FOREIGN KEY (`idPersona`) REFERENCES `personas` (`idPersona`);

ALTER TABLE `telefonosorganizacion`
  ADD CONSTRAINT `telefonosorganizacion_ibfk_1` FOREIGN KEY (`idOrganizacion`) REFERENCES `organizaciones` (`idOrganizacion`);
SET FOREIGN_KEY_CHECKS=1;
COMMIT;